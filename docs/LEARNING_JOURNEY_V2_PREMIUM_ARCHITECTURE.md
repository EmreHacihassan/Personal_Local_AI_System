# ğŸ—ï¸ Learning Journey V2 - Premium Mimari TasarÄ±mÄ±

## ğŸ¯ Hedef Vizyon

**Deep Scholar 2.0 tarzÄ± Multi-Agent Multi-Model Ã–ÄŸrenme Sistemi**

```
KullanÄ±cÄ±: "Matematik Ã¶ÄŸrenmek istiyorum"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI CURRICULUM STUDIO                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ§  Curriculum Orchestrator                                â”‚  â”‚
â”‚  â”‚    "5 uzman agent'Ä±m var, ÅŸimdi analiz baÅŸlÄ±yor..."      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â–¼            â–¼           â–¼           â–¼            â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚Peda- â”‚   â”‚Rese- â”‚   â”‚Cont- â”‚   â”‚Exam  â”‚   â”‚Revi- â”‚        â”‚
â”‚  â”‚gogy  â”‚   â”‚arch  â”‚   â”‚ent   â”‚   â”‚      â”‚   â”‚ew    â”‚        â”‚
â”‚  â”‚Agent â”‚   â”‚Agent â”‚   â”‚Agent â”‚   â”‚Agent â”‚   â”‚Agent â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚     â”‚            â”‚           â”‚           â”‚            â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ¤– Multi-Model Layer                                      â”‚  â”‚
â”‚  â”‚    Ollama (qwen3) â”‚ OpenAI (gpt-4o) â”‚ Claude â”‚ Gemini    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
KiÅŸiselleÅŸtirilmiÅŸ MÃ¼fredat (30-120 saniye dÃ¼ÅŸÃ¼nme)
```

---

## ğŸ“ Yeni Dosya YapÄ±sÄ±

```
core/learning_journey_v2/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ models.py                    # Mevcut (gÃ¼ncelleme)
â”œâ”€â”€ 
â”œâ”€â”€ # ğŸ†• MULTI-AGENT CURRICULUM STUDIO
â”œâ”€â”€ curriculum_studio/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ orchestrator.py          # Ana orkestratÃ¶r
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_agent.py        # Temel agent sÄ±nÄ±fÄ±
â”‚   â”‚   â”œâ”€â”€ pedagogy_agent.py    # EÄŸitim bilimi uzmanÄ±
â”‚   â”‚   â”œâ”€â”€ research_agent.py    # RAG + Web araÅŸtÄ±rmacÄ±
â”‚   â”‚   â”œâ”€â”€ content_agent.py     # Ä°Ã§erik tasarÄ±mcÄ±sÄ±
â”‚   â”‚   â”œâ”€â”€ exam_agent.py        # SÄ±nav oluÅŸturucu
â”‚   â”‚   â””â”€â”€ review_agent.py      # Kalite kontrol
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ multi_model_layer.py # LLM abstraction
â”‚
â”œâ”€â”€ # ğŸ†• SPACED REPETITION ENGINE
â”œâ”€â”€ spaced_repetition/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ sm2_algorithm.py         # SM-2 algoritmasÄ±
â”‚   â”œâ”€â”€ leitner_box.py           # Leitner kutu sistemi
â”‚   â”œâ”€â”€ mastery_tracker.py       # Konu ustalÄ±k takibi
â”‚   â””â”€â”€ review_scheduler.py      # Tekrar zamanlayÄ±cÄ±
â”‚
â”œâ”€â”€ # ğŸ†• WEAKNESS DETECTION
â”œâ”€â”€ weakness_detection/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ performance_analyzer.py  # Test performans analizi
â”‚   â”œâ”€â”€ weakness_detector.py     # ZayÄ±f alan tespiti
â”‚   â””â”€â”€ adaptive_content.py      # Adaptif iÃ§erik seÃ§imi
â”‚
â”œâ”€â”€ # ğŸ†• DYNAMIC STAGE CLOSURE
â”œâ”€â”€ dynamic_closure/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ closure_generator.py     # Dinamik kapanÄ±ÅŸ Ã¼retici
â”‚   â””â”€â”€ weakness_emphasis.py     # ZayÄ±f alan vurgusu
â”‚
â”œâ”€â”€ # Mevcut (gÃ¼ncelleme)
â”œâ”€â”€ curriculum_planner.py        # Legacy - yeni sisteme wrapper
â”œâ”€â”€ content_generator.py         # GÃ¼ncelleme
â”œâ”€â”€ exam_system.py               # GÃ¼ncelleme
â”œâ”€â”€ orchestrator.py              # GÃ¼ncelleme
â””â”€â”€ certificate_system.py        # Mevcut
```

---

## ğŸ§  Multi-Agent Curriculum Studio

### 1. Base Agent

```python
# core/learning_journey_v2/curriculum_studio/agents/base_agent.py

from abc import ABC, abstractmethod
from dataclasses import dataclass, field
from typing import List, Dict, Any, AsyncGenerator
from datetime import datetime
import asyncio

@dataclass
class AgentThought:
    """Visible reasoning - gÃ¶rÃ¼nÃ¼r dÃ¼ÅŸÃ¼nce"""
    agent_name: str
    step: str
    thinking: str          # "Åimdi konularÄ± analiz ediyorum..."
    reasoning: str         # DetaylÄ± mantÄ±k zinciri
    conclusion: str        # SonuÃ§
    confidence: float      # 0.0 - 1.0
    timestamp: str = field(default_factory=lambda: datetime.now().isoformat())
    duration_ms: int = 0

@dataclass
class AgentOutput:
    """Agent Ã§Ä±ktÄ±sÄ±"""
    agent_name: str
    result: Dict[str, Any]
    thoughts: List[AgentThought]
    success: bool
    error: Optional[str] = None

class BaseCurriculumAgent(ABC):
    """
    Curriculum Studio Base Agent
    
    Her agent:
    - BaÄŸÄ±msÄ±z dÃ¼ÅŸÃ¼nebilir
    - DÃ¼ÅŸÃ¼nce sÃ¼recini stream edebilir
    - DiÄŸer agentlarla iletiÅŸim kurabilir
    """
    
    def __init__(
        self,
        name: str,
        role: str,
        model_preference: str = "ollama/qwen3",
        fallback_models: List[str] = None
    ):
        self.name = name
        self.role = role
        self.model_preference = model_preference
        self.fallback_models = fallback_models or ["openai/gpt-4o", "ollama/llama3"]
        self.thoughts: List[AgentThought] = []
        
    async def think(
        self, 
        prompt: str, 
        step: str
    ) -> AsyncGenerator[AgentThought, None]:
        """
        DÃ¼ÅŸÃ¼nme sÃ¼reci - stream olarak dÃ¼ÅŸÃ¼nceleri yayÄ±nla
        """
        start_time = datetime.now()
        
        # DÃ¼ÅŸÃ¼nme baÅŸladÄ±
        yield AgentThought(
            agent_name=self.name,
            step=step,
            thinking=f"ğŸ¤” {step} Ã¼zerinde dÃ¼ÅŸÃ¼nÃ¼yorum...",
            reasoning="",
            conclusion="",
            confidence=0.0
        )
        
        # LLM Ã§aÄŸrÄ±sÄ±
        try:
            response = await self._call_llm(prompt)
            
            thought = AgentThought(
                agent_name=self.name,
                step=step,
                thinking=f"âœ… {step} tamamlandÄ±",
                reasoning=response.get("reasoning", ""),
                conclusion=response.get("conclusion", ""),
                confidence=response.get("confidence", 0.8),
                duration_ms=int((datetime.now() - start_time).total_seconds() * 1000)
            )
            self.thoughts.append(thought)
            yield thought
            
        except Exception as e:
            yield AgentThought(
                agent_name=self.name,
                step=step,
                thinking=f"âš ï¸ {step} sÄ±rasÄ±nda hata: {str(e)}",
                reasoning="Fallback model deneniyor...",
                conclusion="",
                confidence=0.0
            )
            
    @abstractmethod
    async def execute(
        self, 
        context: Dict[str, Any]
    ) -> AsyncGenerator[AgentThought, None]:
        """Agent'Ä±n ana gÃ¶revi"""
        pass
    
    async def _call_llm(self, prompt: str) -> Dict[str, Any]:
        """LLM Ã§aÄŸrÄ±sÄ± - multi-model fallback ile"""
        # Multi-model layer kullanÄ±lacak
        pass
```

### 2. Pedagogy Agent (EÄŸitim Bilimi UzmanÄ±)

```python
# core/learning_journey_v2/curriculum_studio/agents/pedagogy_agent.py

class PedagogyAgent(BaseCurriculumAgent):
    """
    Pedagoji UzmanÄ± Agent
    
    Sorumluluklar:
    - Ã–ÄŸrenme hedefi analizi
    - Pedagojik sÄ±ralama
    - Bloom taksonomisi uygulamasÄ±
    - Ã–ÄŸrenme stili adaptasyonu
    """
    
    def __init__(self):
        super().__init__(
            name="Pedagoji UzmanÄ±",
            role="EÄŸitim bilimi ve Ã¶ÄŸrenme teorileri uzmanÄ±",
            model_preference="openai/gpt-4o"  # Pedagoji iÃ§in gÃ¼Ã§lÃ¼ model
        )
        
    async def execute(
        self, 
        context: Dict[str, Any]
    ) -> AsyncGenerator[AgentThought, None]:
        """
        Pedagojik analiz yap
        """
        goal = context.get("goal")
        
        # AdÄ±m 1: Hedef Analizi
        async for thought in self.think(
            prompt=f"""
            Ã–ÄŸrenme hedefi: {goal.title}
            Konu: {goal.subject}
            Hedef: {goal.target_outcome}
            
            Bu hedefe ulaÅŸmak iÃ§in:
            1. Hangi Ã¶n bilgiler gerekli?
            2. Bloom taksonomisine gÃ¶re Ã¶ÄŸrenme seviyesi ne olmalÄ±?
            3. Ã–nerilen Ã¶ÄŸrenme yolu nasÄ±l olmalÄ±?
            
            JSON formatÄ±nda analiz et.
            """,
            step="hedef_analizi"
        ):
            yield thought
        
        # AdÄ±m 2: Pedagojik SÄ±ralama
        async for thought in self.think(
            prompt=f"""
            Konu: {goal.subject}
            
            Bu konunun alt baÅŸlÄ±klarÄ±nÄ± pedagojik olarak doÄŸru sÄ±raya koy.
            Ã–n koÅŸullar â†’ Temel kavramlar â†’ Ä°leri konular â†’ Uygulama
            
            JSON formatÄ±nda sÄ±ralÄ± liste dÃ¶ndÃ¼r.
            """,
            step="pedagojik_siralama"
        ):
            yield thought
        
        # AdÄ±m 3: Ã–ÄŸrenme Stili Adaptasyonu
        async for thought in self.think(
            prompt=f"""
            Ã–ÄŸrenci profili:
            - Ã–ÄŸrenme stili: {goal.learning_style or 'BelirtilmemiÅŸ'}
            - GÃ¼nlÃ¼k Ã§alÄ±ÅŸma: {goal.daily_hours} saat
            - Tercih edilen iÃ§erik: {goal.content_preferences}
            
            Bu profile gÃ¶re:
            1. Hangi iÃ§erik tÃ¼rleri aÄŸÄ±rlÄ±klÄ± olmalÄ±?
            2. Paket sÃ¼releri ne kadar olmalÄ±?
            3. Pratik/teori oranÄ± ne olmalÄ±?
            """,
            step="ogrenme_stili_adaptasyonu"
        ):
            yield thought
```

### 3. Research Agent

```python
# core/learning_journey_v2/curriculum_studio/agents/research_agent.py

class ResearchAgent(BaseCurriculumAgent):
    """
    AraÅŸtÄ±rma Agent
    
    Sorumluluklar:
    - RAG ile bilgi Ã§ekme
    - Web araÅŸtÄ±rmasÄ±
    - GÃ¼ncel iÃ§erik bulma
    - Kaynak doÄŸrulama
    """
    
    def __init__(self, rag_service=None, web_search_service=None):
        super().__init__(
            name="AraÅŸtÄ±rma UzmanÄ±",
            role="Bilgi toplama ve doÄŸrulama uzmanÄ±",
            model_preference="ollama/qwen3"  # HÄ±zlÄ± model
        )
        self.rag = rag_service
        self.web_search = web_search_service
        
    async def execute(
        self, 
        context: Dict[str, Any]
    ) -> AsyncGenerator[AgentThought, None]:
        """
        Konu araÅŸtÄ±rmasÄ± yap
        """
        topics = context.get("topics", [])
        
        # RAG AraÅŸtÄ±rmasÄ±
        async for thought in self.think(
            prompt=f"RAG'dan '{', '.join(topics)}' konularÄ±nÄ± araÅŸtÄ±r",
            step="rag_arastirmasi"
        ):
            yield thought
        
        # Web AraÅŸtÄ±rmasÄ±
        async for thought in self.think(
            prompt=f"Web'den gÃ¼ncel '{', '.join(topics)}' kaynaklarÄ± bul",
            step="web_arastirmasi"
        ):
            yield thought
```

### 4. Curriculum Studio Orchestrator

```python
# core/learning_journey_v2/curriculum_studio/orchestrator.py

class CurriculumStudioOrchestrator:
    """
    Multi-Agent Curriculum Orchestrator
    
    5 uzman agent'Ä± koordine eder:
    1. Pedagogy Agent - EÄŸitim bilimi
    2. Research Agent - AraÅŸtÄ±rma
    3. Content Agent - Ä°Ã§erik tasarÄ±mÄ±
    4. Exam Agent - SÄ±nav oluÅŸturma
    5. Review Agent - Kalite kontrol
    """
    
    def __init__(self):
        self.agents = {
            "pedagogy": PedagogyAgent(),
            "research": ResearchAgent(),
            "content": ContentDesignAgent(),
            "exam": ExamCreationAgent(),
            "review": ReviewAgent()
        }
        
    async def create_curriculum(
        self,
        goal: LearningGoal
    ) -> AsyncGenerator[AgentThought, None]:
        """
        Multi-agent curriculum oluÅŸturma
        
        Yields:
            AgentThought - Her agent'Ä±n dÃ¼ÅŸÃ¼ncesi real-time
        """
        context = {"goal": goal}
        
        # Orchestrator baÅŸlangÄ±Ã§ mesajÄ±
        yield AgentThought(
            agent_name="Curriculum Studio",
            step="baslatma",
            thinking="ğŸ¬ 5 uzman agent mÃ¼fredatÄ±nÄ± hazÄ±rlÄ±yor...",
            reasoning="Pedagoji, AraÅŸtÄ±rma, Ä°Ã§erik, SÄ±nav ve Kalite Kontrol uzmanlarÄ± devreye giriyor.",
            conclusion="",
            confidence=1.0
        )
        
        # ===== FAZ 1: Paralel Analiz =====
        yield AgentThought(
            agent_name="Curriculum Studio",
            step="faz_1",
            thinking="ğŸ“Š Faz 1: Paralel Analiz BaÅŸlÄ±yor...",
            reasoning="Pedagoji ve AraÅŸtÄ±rma agent'larÄ± eÅŸ zamanlÄ± Ã§alÄ±ÅŸacak",
            conclusion="",
            confidence=1.0
        )
        
        # Pedagogy ve Research paralel Ã§alÄ±ÅŸsÄ±n
        pedagogy_task = asyncio.create_task(
            self._run_agent("pedagogy", context)
        )
        research_task = asyncio.create_task(
            self._run_agent("research", context)
        )
        
        # Her iki agent'tan gelen dÃ¼ÅŸÃ¼nceleri stream et
        async for thought in self._merge_streams([pedagogy_task, research_task]):
            yield thought
        
        # SonuÃ§larÄ± context'e ekle
        context["pedagogy_result"] = await pedagogy_task
        context["research_result"] = await research_task
        
        # ===== FAZ 2: Ä°Ã§erik ve SÄ±nav TasarÄ±mÄ± =====
        yield AgentThought(
            agent_name="Curriculum Studio",
            step="faz_2",
            thinking="ğŸ“ Faz 2: Ä°Ã§erik ve SÄ±nav TasarÄ±mÄ±...",
            reasoning="Pedagoji analizine gÃ¶re iÃ§erik ve sÄ±navlar tasarlanÄ±yor",
            conclusion="",
            confidence=1.0
        )
        
        # Content ve Exam paralel
        async for thought in self.agents["content"].execute(context):
            yield thought
            
        async for thought in self.agents["exam"].execute(context):
            yield thought
        
        # ===== FAZ 3: Kalite Kontrol =====
        yield AgentThought(
            agent_name="Curriculum Studio",
            step="faz_3",
            thinking="ğŸ” Faz 3: Kalite Kontrol...",
            reasoning="TÃ¼m Ã§Ä±ktÄ±lar gÃ¶zden geÃ§iriliyor",
            conclusion="",
            confidence=1.0
        )
        
        async for thought in self.agents["review"].execute(context):
            yield thought
        
        # Final
        yield AgentThought(
            agent_name="Curriculum Studio",
            step="tamamlandi",
            thinking="âœ… MÃ¼fredat hazÄ±rlandÄ±!",
            reasoning="5 uzman agent baÅŸarÄ±yla tamamladÄ±",
            conclusion="KiÅŸiselleÅŸtirilmiÅŸ mÃ¼fredat hazÄ±r",
            confidence=1.0
        )
```

---

## ğŸ”„ Spaced Repetition Engine

### SM-2 AlgoritmasÄ±

```python
# core/learning_journey_v2/spaced_repetition/sm2_algorithm.py

from dataclasses import dataclass
from datetime import datetime, timedelta
from typing import Optional

@dataclass
class ReviewCard:
    """Tekrar kartÄ±"""
    card_id: str
    topic: str
    question_id: str
    
    # SM-2 parametreleri
    easiness_factor: float = 2.5  # E-Factor (1.3 - 2.5)
    interval: int = 1             # GÃ¼n cinsinden interval
    repetition: int = 0           # Tekrar sayÄ±sÄ±
    
    # Zamanlama
    next_review: Optional[datetime] = None
    last_review: Optional[datetime] = None
    
    # Mastery
    mastery_level: float = 0.0    # 0-100

class SM2Algorithm:
    """
    SuperMemo 2 AlgoritmasÄ±
    
    AralÄ±klÄ± tekrar iÃ§in altÄ±n standart algoritma.
    """
    
    @staticmethod
    def calculate_next_review(
        card: ReviewCard,
        quality: int  # 0-5 arasÄ± (0=tam yanlÄ±ÅŸ, 5=mÃ¼kemmel)
    ) -> ReviewCard:
        """
        Kaliteye gÃ¶re sonraki tekrar zamanÄ±nÄ± hesapla
        
        Args:
            card: Mevcut kart durumu
            quality: 0-5 arasÄ± performans deÄŸeri
                0: Tamamen yanlÄ±ÅŸ
                1: YanlÄ±ÅŸ ama tanÄ±dÄ±k
                2: YanlÄ±ÅŸ ama hatÄ±rladÄ±
                3: DoÄŸru ama zor
                4: DoÄŸru
                5: MÃ¼kemmel
        
        Returns:
            GÃ¼ncellenmiÅŸ kart
        """
        # E-Factor gÃ¼ncelleme
        new_ef = card.easiness_factor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))
        new_ef = max(1.3, new_ef)  # Minimum 1.3
        
        # Interval hesaplama
        if quality < 3:
            # BaÅŸarÄ±sÄ±z - sÄ±fÄ±rla
            new_interval = 1
            new_repetition = 0
        else:
            # BaÅŸarÄ±lÄ±
            if card.repetition == 0:
                new_interval = 1
            elif card.repetition == 1:
                new_interval = 6
            else:
                new_interval = round(card.interval * new_ef)
            new_repetition = card.repetition + 1
        
        # Mastery gÃ¼ncelleme
        mastery_delta = (quality - 2.5) * 10  # -25 to +25
        new_mastery = max(0, min(100, card.mastery_level + mastery_delta))
        
        # Sonraki tekrar zamanÄ±
        next_review = datetime.now() + timedelta(days=new_interval)
        
        return ReviewCard(
            card_id=card.card_id,
            topic=card.topic,
            question_id=card.question_id,
            easiness_factor=new_ef,
            interval=new_interval,
            repetition=new_repetition,
            next_review=next_review,
            last_review=datetime.now(),
            mastery_level=new_mastery
        )
```

### Mastery Tracker

```python
# core/learning_journey_v2/spaced_repetition/mastery_tracker.py

class MasteryTracker:
    """
    Konu UstalÄ±k Takip Sistemi
    
    Her konu iÃ§in:
    - Mastery seviyesi (0-100%)
    - Tekrar kartlarÄ±
    - ZayÄ±f alan tespiti
    """
    
    def __init__(self):
        self.topic_mastery: Dict[str, float] = {}
        self.cards: Dict[str, List[ReviewCard]] = {}
        
    def record_performance(
        self,
        topic: str,
        question_id: str,
        is_correct: bool,
        confidence: float = 0.5
    ) -> float:
        """
        Performans kaydet ve mastery gÃ¼ncelle
        """
        # SM-2 quality hesapla
        if is_correct:
            quality = 3 + int(confidence * 2)  # 3-5
        else:
            quality = int(confidence * 2)  # 0-2
        
        # Kart bul veya oluÅŸtur
        card = self._get_or_create_card(topic, question_id)
        
        # SM-2 uygula
        updated_card = SM2Algorithm.calculate_next_review(card, quality)
        self._save_card(updated_card)
        
        # Topic mastery gÃ¼ncelle
        self._update_topic_mastery(topic)
        
        return self.topic_mastery.get(topic, 0)
    
    def get_weak_topics(self, threshold: float = 50.0) -> List[str]:
        """ZayÄ±f konularÄ± getir"""
        return [
            topic for topic, mastery in self.topic_mastery.items()
            if mastery < threshold
        ]
    
    def get_due_reviews(self) -> List[ReviewCard]:
        """Tekrar zamanÄ± gelen kartlarÄ± getir"""
        now = datetime.now()
        due_cards = []
        
        for topic_cards in self.cards.values():
            for card in topic_cards:
                if card.next_review and card.next_review <= now:
                    due_cards.append(card)
        
        return sorted(due_cards, key=lambda c: c.next_review)
```

---

## ğŸ¯ Weakness Detection System

```python
# core/learning_journey_v2/weakness_detection/weakness_detector.py

class WeaknessDetector:
    """
    ZayÄ±f Alan Tespit Sistemi
    
    Test sonuÃ§larÄ±ndan:
    - ZayÄ±f konularÄ± tespit et
    - Hata paternlerini analiz et
    - KiÅŸiselleÅŸtirilmiÅŸ Ã¶neriler sun
    """
    
    def __init__(self, mastery_tracker: MasteryTracker):
        self.mastery_tracker = mastery_tracker
        
    def analyze_exam_result(
        self,
        exam_result: ExamResult
    ) -> Dict[str, Any]:
        """
        SÄ±nav sonucunu analiz et
        """
        weakness_map = {}
        
        for criteria in exam_result.criteria_scores:
            topic = criteria.criteria_name
            ratio = criteria.score / criteria.max_score
            
            if ratio < 0.6:  # %60 altÄ± = zayÄ±f
                weakness_map[topic] = {
                    "score": criteria.score,
                    "max_score": criteria.max_score,
                    "ratio": ratio,
                    "feedback": criteria.feedback,
                    "severity": "critical" if ratio < 0.3 else "moderate"
                }
        
        return weakness_map
    
    def generate_stage_closure_emphasis(
        self,
        stage_id: str,
        all_results: List[ExamResult]
    ) -> Dict[str, Any]:
        """
        Stage bitirme paketi iÃ§in zayÄ±f alan vurgusunu hesapla
        """
        topic_performance = {}
        
        # TÃ¼m sonuÃ§larÄ± topla
        for result in all_results:
            for criteria in result.criteria_scores:
                topic = criteria.criteria_name
                if topic not in topic_performance:
                    topic_performance[topic] = []
                topic_performance[topic].append(criteria.score / criteria.max_score)
        
        # Ortalama hesapla
        topic_averages = {
            topic: sum(scores) / len(scores)
            for topic, scores in topic_performance.items()
        }
        
        # ZayÄ±ftan gÃ¼Ã§lÃ¼ye sÄ±rala
        sorted_topics = sorted(topic_averages.items(), key=lambda x: x[1])
        
        # Stage closure iÃ§in soru daÄŸÄ±lÄ±mÄ±
        question_distribution = {}
        remaining_questions = 30  # Toplam soru sayÄ±sÄ±
        
        for topic, avg in sorted_topics:
            if avg < 0.5:
                # Ã‡ok zayÄ±f: %40 soru
                questions = int(remaining_questions * 0.4)
            elif avg < 0.7:
                # Orta zayÄ±f: %25 soru
                questions = int(remaining_questions * 0.25)
            else:
                # Ä°yi: %10 soru
                questions = int(remaining_questions * 0.1)
            
            question_distribution[topic] = questions
            remaining_questions -= questions
        
        return {
            "topic_averages": topic_averages,
            "weak_topics": [t for t, a in sorted_topics if a < 0.6],
            "question_distribution": question_distribution,
            "emphasis_message": self._generate_emphasis_message(sorted_topics)
        }
    
    def _generate_emphasis_message(self, sorted_topics: List[Tuple[str, float]]) -> str:
        """KiÅŸiselleÅŸtirilmiÅŸ vurgu mesajÄ±"""
        weak_count = sum(1 for _, avg in sorted_topics if avg < 0.6)
        
        if weak_count == 0:
            return "Harika gidiyorsun! ğŸŒŸ TÃ¼m konularda iyi bir seviyedesin."
        elif weak_count <= 2:
            topics = [t for t, a in sorted_topics if a < 0.6]
            return f"ğŸ“š {', '.join(topics)} konularÄ±na biraz daha odaklanmalÄ±sÄ±n."
        else:
            return f"âš ï¸ {weak_count} konuda geliÅŸim gerekiyor. EndiÅŸelenme, bu test tam da bunun iÃ§in!"
```

---

## ğŸ” Puan BazlÄ± Kilitleme

```python
# core/learning_journey_v2/models.py gÃ¼ncelleme

@dataclass
class Package:
    # ... mevcut alanlar ...
    
    # Yeni alanlar
    is_locked: bool = True
    lock_reason: Optional[str] = None
    required_score: float = 70.0
    attempt_count: int = 0
    max_attempts: int = 5
    last_attempt_score: Optional[float] = None
    
    def can_proceed(self) -> Tuple[bool, str]:
        """
        Bir sonraki pakete geÃ§ilebilir mi?
        """
        if self.status != PackageStatus.PASSED:
            return False, "Paketi tamamlamadÄ±n"
        
        if self.last_attempt_score is None:
            return False, "HenÃ¼z test Ã§Ã¶zmedin"
        
        if self.last_attempt_score < self.required_score:
            return False, f"Minimum %{self.required_score} puan gerekli. AldÄ±ÄŸÄ±n: %{self.last_attempt_score:.1f}"
        
        return True, "GeÃ§ebilirsin!"
    
    def record_attempt(self, score: float) -> Dict[str, Any]:
        """
        Test denemesi kaydet
        """
        self.attempt_count += 1
        self.last_attempt_score = score
        
        if score >= self.required_score:
            self.status = PackageStatus.PASSED
            return {
                "passed": True,
                "message": "Tebrikler! ğŸ‰ Bir sonraki pakete geÃ§ebilirsin.",
                "unlock_next": True
            }
        else:
            remaining = self.max_attempts - self.attempt_count
            if remaining <= 0:
                return {
                    "passed": False,
                    "message": "Maksimum deneme hakkÄ±nÄ± kullandÄ±n. YardÄ±m almak ister misin?",
                    "unlock_next": False,
                    "offer_help": True
                }
            return {
                "passed": False,
                "message": f"Puan yetersiz. {remaining} deneme hakkÄ±n kaldÄ±.",
                "unlock_next": False,
                "remaining_attempts": remaining
            }
```

---

## ğŸ–¥ï¸ Frontend GÃ¼ncellemeleri

### 1. Real-time Agent Streaming

```tsx
// frontend-next/src/components/learning/AgentThinkingStream.tsx

interface AgentThought {
  agent_name: string;
  step: string;
  thinking: string;
  reasoning: string;
  conclusion: string;
  confidence: number;
}

const AgentThinkingStream: React.FC<{
  thoughts: AgentThought[];
  isStreaming: boolean;
}> = ({ thoughts, isStreaming }) => {
  return (
    <div className="space-y-4">
      {/* Agent AvatarlarÄ± */}
      <div className="flex gap-4 justify-center">
        {AGENTS.map(agent => (
          <AgentAvatar 
            key={agent.name}
            agent={agent}
            isActive={thoughts.some(t => t.agent_name === agent.name)}
          />
        ))}
      </div>
      
      {/* DÃ¼ÅŸÃ¼nce AkÄ±ÅŸÄ± */}
      <div className="space-y-3 max-h-96 overflow-auto">
        <AnimatePresence>
          {thoughts.map((thought, idx) => (
            <motion.div
              key={`${thought.agent_name}-${thought.step}-${idx}`}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              className="p-4 rounded-xl bg-gray-800/50 border border-gray-700"
            >
              <div className="flex items-center gap-2 mb-2">
                <span className="text-sm font-medium text-purple-400">
                  {thought.agent_name}
                </span>
                <span className="text-xs text-gray-500">
                  {thought.step}
                </span>
              </div>
              
              <p className="text-white">{thought.thinking}</p>
              
              {thought.reasoning && (
                <p className="text-sm text-gray-400 mt-2 italic">
                  ğŸ’­ {thought.reasoning}
                </p>
              )}
              
              {thought.conclusion && (
                <p className="text-sm text-green-400 mt-2">
                  âœ… {thought.conclusion}
                </p>
              )}
            </motion.div>
          ))}
        </AnimatePresence>
        
        {isStreaming && (
          <motion.div
            animate={{ opacity: [0.5, 1, 0.5] }}
            transition={{ repeat: Infinity, duration: 1 }}
            className="text-center text-purple-400"
          >
            Agent'lar dÃ¼ÅŸÃ¼nÃ¼yor...
          </motion.div>
        )}
      </div>
    </div>
  );
};
```

### 2. Mastery Progress Bar

```tsx
// frontend-next/src/components/learning/MasteryProgress.tsx

const MasteryProgress: React.FC<{
  topics: Array<{
    name: string;
    mastery: number;
    isWeak: boolean;
  }>;
}> = ({ topics }) => {
  return (
    <div className="space-y-3">
      {topics.map(topic => (
        <div key={topic.name} className="space-y-1">
          <div className="flex justify-between text-sm">
            <span className={topic.isWeak ? "text-red-400" : "text-white"}>
              {topic.isWeak && "âš ï¸ "}{topic.name}
            </span>
            <span className="text-gray-400">%{topic.mastery.toFixed(0)}</span>
          </div>
          <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
            <motion.div
              initial={{ width: 0 }}
              animate={{ width: `${topic.mastery}%` }}
              className={`h-full rounded-full ${
                topic.mastery >= 80 ? "bg-green-500" :
                topic.mastery >= 50 ? "bg-yellow-500" :
                "bg-red-500"
              }`}
            />
          </div>
        </div>
      ))}
    </div>
  );
};
```

---

## ğŸ“… Uygulama Zaman Ã‡izelgesi

### Hafta 1: Core Infrastructure
- [ ] `curriculum_studio/` klasÃ¶r yapÄ±sÄ±
- [ ] `BaseCurriculumAgent` implementasyonu
- [ ] `PedagogyAgent` implementasyonu
- [ ] Multi-model layer

### Hafta 2: Agent'lar + Spaced Repetition
- [ ] DiÄŸer 4 agent
- [ ] `CurriculumStudioOrchestrator`
- [ ] SM-2 algoritmasÄ±
- [ ] `MasteryTracker`

### Hafta 3: Weakness + Dynamic Closure
- [ ] `WeaknessDetector`
- [ ] Dynamic stage closure generator
- [ ] Puan bazlÄ± kilitleme enforcement

### Hafta 4: Frontend
- [ ] `AgentThinkingStream` component
- [ ] `MasteryProgress` component
- [ ] WebSocket streaming entegrasyonu
- [ ] Test ve polish

---

*Bu tasarÄ±m belgesi, Learning Journey V2'nin premium versiyonunu tanÄ±mlar.*
